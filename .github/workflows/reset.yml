name: NUKE - Reset repository content

on:
  workflow_dispatch:
    inputs:
      confirm:
        description: 'Type EXACTLY: I_UNDERSTAND_THIS_WILL_DELETE_EVERYTHING'
        required: true
        type: string

permissions:
  contents: write

jobs:
  nuke:
    runs-on: ubuntu-latest
    steps:
      - name: Safety check
        run: |
          if [ "${{ inputs.confirm }}" != "I_UNDERSTAND_THIS_WILL_DELETE_EVERYTHING" ]; then
            echo "Confirmation string mismatch. Aborting."
            exit 1
          fi

      - name: Checkout
        uses: actions/checkout@v4

      - name: Delete everything in the repo (except .git)
        run: |
          find . -mindepth 1 -maxdepth 1 ! -name ".git" -exec rm -rf {} +

      - name: Create fresh minimal baseline
        run: |
          echo "# Repo reset" > README.md
          echo "" >> README.md
          echo "This repository was reset via a manual workflow." >> README.md

      - name: Commit & push reset
        run: |
          git config user.name "repo-reset-bot"
          git config user.email "repo-reset-bot@users.noreply.github.com"
          git add -A
          git commit -m "chore: reset repository content"
          git push
